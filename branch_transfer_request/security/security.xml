<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Security Groups -->
    <record id="group_internal_transfer_user" model="res.groups">
        <field name="name">User: Internal Transfer Request</field>
        <field name="category_id" ref="base.module_category_inventory_inventory"/>
        <field name="implied_ids" eval="[(4, ref('stock.group_stock_user'))]"/>
    </record>

    <record id="group_internal_transfer_manager" model="res.groups">
        <field name="name">Manager: Internal Transfer Request</field>
        <field name="category_id" ref="base.module_category_inventory_inventory"/>
        <field name="implied_ids" eval="[(4, ref('group_internal_transfer_user')), (4, ref('stock.group_stock_manager'))]"/>
    </record>

    <!-- Access Rights -->
    <!-- ir.model.access.csv content -->
    <record id="access_internal_transfer_request_user" model="ir.model.access">
        <field name="name">internal.transfer.request.user</field>
        <field name="model_id" ref="model_internal_transfer_request"/>
        <field name="group_id" ref="group_internal_transfer_user"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="0"/>
    </record>

    <record id="access_internal_transfer_request_manager" model="ir.model.access">
        <field name="name">internal.transfer.request.manager</field>
        <field name="model_id" ref="model_internal_transfer_request"/>
        <field name="group_id" ref="group_internal_transfer_manager"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <record id="access_internal_transfer_request_line_user" model="ir.model.access">
        <field name="name">internal.transfer.request.line.user</field>
        <field name="model_id" ref="model_internal_transfer_request_line"/>
        <field name="group_id" ref="group_internal_transfer_user"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <record id="access_internal_transfer_request_line_manager" model="ir.model.access">
        <field name="name">internal.transfer.request.line.manager</field>
        <field name="model_id" ref="model_internal_transfer_request_line"/>
        <field name="group_id" ref="group_internal_transfer_manager"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Record Rules -->
    <record id="internal_transfer_request_user_rule" model="ir.rule">
        <field name="name">Internal Transfer Request: User can see own requests</field>
        <field name="model_id" ref="model_internal_transfer_request"/>
        <field name="domain_force">['|', 
            ('requester_id', '=', user.id),
            ('source_warehouse_id.company_id', 'in', company_ids),
            ('destination_warehouse_id.company_id', 'in', company_ids)
        ]</field>
        <field name="groups" eval="[(4, ref('group_internal_transfer_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="0"/>
    </record>

    <record id="internal_transfer_request_manager_rule" model="ir.rule">
        <field name="name">Internal Transfer Request: Manager can see all</field>
        <field name="model_id" ref="model_internal_transfer_request"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_internal_transfer_manager'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

</odoo>